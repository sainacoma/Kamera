<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Hand Gesture Reader</title>
  <style>
    :root{
      --bg:#0b1020;--panel:#121a33;--text:#e8ecff;--muted:#9aa4c7;--accent:#7aa2ff;--good:#72d572;--bad:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b1020,#0d1330 40%,#0b1020);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{padding:20px 24px;border-bottom:1px solid rgba(255,255,255,.06);position:sticky;top:0;background:#0b1020aa;backdrop-filter:blur(8px)}
    h1{margin:0;font-size:20px;letter-spacing:.2px}
    main{display:grid;grid-template-columns:1.2fr .8fr;gap:18px;padding:18px;align-items:start}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.06);border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    .pad{padding:14px}
    .video-wrap{position:relative;overflow:hidden}
    video,canvas{display:block;width:100%;height:auto;border-radius:16px}
    canvas{position:absolute;left:0;top:0}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .btn{background:var(--accent);color:#0b1020;border:none;padding:10px 14px;border-radius:12px;font-weight:600;cursor:pointer}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    .status{font:600 14px/1.3 system-ui;padding:8px 12px;border-radius:12px;background:#0e1430;border:1px solid rgba(255,255,255,.06)}
    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:#0e1430;border:1px solid rgba(255,255,255,.06);color:var(--muted)}
    .gesture{font-size:28px;font-weight:800;letter-spacing:.3px}
    .good{color:var(--good)}.bad{color:var(--bad)}
    .legend{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:8px}
    .legend .chip{justify-content:space-between}
    footer{padding:12px 18px;color:var(--muted);font-size:12px;text-align:center}
    @media (max-width: 900px){main{grid-template-columns:1fr;}}
  </style>
</head>
<body>
  <header>
    <h1>üñêÔ∏è Hand Gesture Reader</h1>
  </header>
  <main>
    <section class="card pad">
      <div class="row" style="justify-content:space-between;margin-bottom:12px">
        <div class="row">
          <button id="startBtn" class="btn">Start Camera</button>
          <select id="cameraSelect" class="status"></select>
        </div>
        <div class="status" id="loadStatus">Loading‚Ä¶</div>
      </div>
      <div class="video-wrap">
        <video id="video" autoplay playsinline muted></video>
        <canvas id="overlay"></canvas>
      </div>
    </section>
    <aside class="card pad">
      <div class="row" style="justify-content:space-between;margin-bottom:8px">
        <div class="chip">Model: <strong id="modelName">MediaPipe Hands</strong></div>
        <div class="chip">FPS: <span id="fps">0</span></div>
      </div>
      <div class="gesture" id="gesture">‚Äî</div>
      <p id="hint" style="color:var(--muted);margin-top:6px">Tunjukkan telapak tangan, kepalkan tangan, tunjuk, OK, atau jempol üëç.</p>
      <hr style="border-color:rgba(255,255,255,.06)">
      <div class="legend">
        <div class="chip">üñêÔ∏è Open Palm <small>(‚â•4 jari)</small></div>
        <div class="chip">‚úä Fist <small>(0 jari)</small></div>
        <div class="chip">üëâ Point <small>(hanya telunjuk)</small></div>
        <div class="chip">üëå OK <small>(ibu jari & telunjuk saling sentuh)</small></div>
        <div class="chip">üëç Thumb Up</div>
        <div class="chip">üëé Thumb Down</div>
      </div>
    </aside>
  </main>
  <footer>
    Works in modern browsers. On phones, pilih kamera depan/belakang jika tersedia.
  </footer>

  <!-- MediaPipe Hands -->
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');
    const gestureEl = document.getElementById('gesture');
    const fpsEl = document.getElementById('fps');
    const loadStatus = document.getElementById('loadStatus');
    const startBtn = document.getElementById('startBtn');
    const cameraSelect = document.getElementById('cameraSelect');

    let lastT = performance.now();
    function tick(){
      const now = performance.now();
      const dt = now - lastT; lastT = now;
      fpsEl.textContent = (1000/dt).toFixed(0);
      requestAnimationFrame(tick);
    }
    tick();

    function setGesture(text, ok){
      gestureEl.textContent = text;
      gestureEl.classList.toggle('good', !!ok);
      gestureEl.classList.toggle('bad', !ok && text !== '‚Äî');
    }

    function resizeCanvas(){
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
    }

    function isFingerUp(landmarks, tipIdx, pipIdx){
      return landmarks[tipIdx].y < landmarks[pipIdx].y;
    }

    function thumbDirection(handedness, landmarks){
      const tip = landmarks[4];
      const ip = landmarks[3];
      return (handedness === 'Right') ? (tip.x < ip.x) : (tip.x > ip.x);
    }

    function distance(a,b){
      const dx = a.x-b.x, dy=a.y-b.y; return Math.hypot(dx,dy);
    }

    function classifyGesture(res){
      const lm = res.landmarks[0]; if(!lm) return '‚Äî';
      const h = res.handednesses[0] && res.handednesses[0].label || 'Right';
      const fingers = [
        isFingerUp(lm,8,6),
        isFingerUp(lm,12,10),
        isFingerUp(lm,16,14),
        isFingerUp(lm,20,18)
      ];
      const upCount = fingers.filter(Boolean).length + (thumbDirection(h,lm)?1:0);

      const indexUpOnly = fingers[0] && !fingers[1] && !fingers[2] && !fingers[3] && !thumbDirection(h,lm);
      const okSign = distance(lm[4], lm[8]) < 0.05 && (!fingers[1] && !fingers[2] && !fingers[3]);

      const thumbUp = thumbDirection(h,lm) && (lm[4].y < lm[0].y) && upCount===1;
      const thumbDown = thumbDirection(h,lm) && (lm[4].y > lm[0].y) && upCount===1;

      if (okSign) return 'üëå OK';
      if (indexUpOnly) return 'üëâ Point';
      if (upCount >= 4) return 'üñêÔ∏è Open Palm';
      if (upCount === 0) return '‚úä Fist';
      if (thumbUp) return 'üëç Thumb Up';
      if (thumbDown) return 'üëé Thumb Down';
      return '‚Ä¶';
    }

    function drawResults(results){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      if (!results.multiHandLandmarks) return;
      for (const landmarks of results.multiHandLandmarks){
        drawConnectors(ctx, landmarks, HAND_CONNECTIONS, {lineWidth: 4});
        drawLandmarks(ctx, landmarks, {lineWidth: 2, radius: 3});
      }
    }

    const hands = new Hands({locateFile: (file)=>`https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
    hands.setOptions({
      maxNumHands: 1,
      modelComplexity: 1,
      minDetectionConfidence: 0.6,
      minTrackingConfidence: 0.6
    });

    hands.onResults((results)=>{
      if (video.videoWidth && canvas.width !== video.videoWidth) resizeCanvas();
      drawResults(results);
      if (results && results.multiHandLandmarks && results.multiHandLandmarks.length){
        const enriched = { landmarks: results.multiHandLandmarks, handednesses: results.multiHandedness };
        const label = classifyGesture(enriched);
        setGesture(label, ['üñêÔ∏è Open Palm','‚úä Fist','üëâ Point','üëå OK','üëç Thumb Up','üëé Thumb Down'].includes(label));
      } else {
        setGesture('‚Äî');
      }
    });

    async function listCameras(){
      try{
        const devices = await navigator.mediaDevices.enumerateDevices();
        const vids = devices.filter(d=>d.kind==='videoinput');
        cameraSelect.innerHTML = '';
        vids.forEach((d,i)=>{
          const opt = document.createElement('option');
          opt.value = d.deviceId; opt.textContent = d.label || `Camera ${i+1}`;
          cameraSelect.appendChild(opt);
        });
      }catch(e){ /* ignore */ }
    }

    let camera;

    async function start(cameraId){
      loadStatus.textContent = 'Requesting camera‚Ä¶';
      if (camera) { await camera.stop(); camera = null; }
      const constraints = {video: { deviceId: cameraId ? {exact: cameraId}: undefined, width: {ideal: 1280}, height: {ideal: 720} }};
      const stream = await navigator.mediaDevices.getUserMedia(constraints);
      video.srcObject = stream;
      await video.play();
      resizeCanvas();
      camera = new Camera(video, {onFrame: async ()=>{ await hands.send({image: video}); }, width: video.videoWidth, height: video.videoHeight});
      camera.start();
      loadStatus.textContent = 'Running';
      await listCameras();
      const current = stream.getVideoTracks()[0];
      const deviceId = current.getSettings().deviceId; if (deviceId){
        for (const o of cameraSelect.options){ if (o.value===deviceId) o.selected = true; }
      }
    }

    startBtn.addEventListener('click', ()=> start(cameraSelect.value||undefined));
    cameraSelect.addEventListener('change', ()=> start(cameraSelect.value));

    window.addEventListener('load', ()=>{
      loadStatus.textContent = 'Ready';
      listCameras();
    });
  </script>
</body>
</html>